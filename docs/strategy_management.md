# ç­–ç•¥ç®¡ç†ç³»ç»Ÿä½¿ç”¨æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [APIæ¥å£](#apiæ¥å£)
5. [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
6. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¦‚è¿°

ç­–ç•¥ç®¡ç†ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„ç­–ç•¥å¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼Œæ”¯æŒç­–ç•¥æ¨¡æ¿åº“ï¼Œå¹¶å¯ä»¥åŸºäºç­–ç•¥è¿›è¡Œå›æµ‹å’Œç®¡ç†å›æµ‹ç»“æœã€‚ç³»ç»Ÿå†…ç½®8ç§å¸¸ç”¨ç­–ç•¥æ¨¡æ¿ï¼Œæ¶µç›–æŠ€æœ¯åˆ†æã€åŸºæœ¬é¢åˆ†æå’Œé‡åŒ–ç­–ç•¥ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿä¸Šæ‰‹é‡åŒ–åˆ†æã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. ç­–ç•¥ç®¡ç†

- **åˆ›å»ºç­–ç•¥**: æ”¯æŒåˆ›å»ºè‡ªå®šä¹‰ç­–ç•¥ï¼ŒåŒ…å«ç­–ç•¥ä»£ç ã€åç§°ã€æè¿°ã€åˆ†ç±»ç­‰ä¿¡æ¯
- **æŸ¥è¯¢ç­–ç•¥**: æ”¯æŒæŒ‰åˆ†ç±»ã€å…³é”®è¯æœç´¢ã€æ’åºç­‰æ–¹å¼æŸ¥è¯¢ç­–ç•¥
- **æ›´æ–°ç­–ç•¥**: æ”¯æŒä¿®æ”¹ç­–ç•¥ä»£ç ã€åç§°ã€æè¿°ç­‰ä¿¡æ¯
- **åˆ é™¤ç­–ç•¥**: æ”¯æŒåˆ é™¤ç­–ç•¥ï¼ˆæ¨¡æ¿ç­–ç•¥éœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

### 2. ç­–ç•¥æ¨¡æ¿åº“

ç³»ç»Ÿæä¾›äº†8ç§ä¸åŒç±»å‹çš„ç­–ç•¥æ¨¡æ¿ï¼š

- **æŠ€æœ¯åˆ†æç±»**:
  - ç®€å•å‡çº¿ç­–ç•¥
  - åŒå‡çº¿ç­–ç•¥ï¼ˆå¢å¼ºç‰ˆï¼‰
  - å¸ƒæ—å¸¦ç­–ç•¥
  - RSIç­–ç•¥

- **åŸºæœ¬é¢åˆ†æç±»**:
  - PE/PBä»·å€¼ç­–ç•¥

- **é‡åŒ–ç­–ç•¥ç±»**:
  - åŠ¨é‡ç­–ç•¥
  - å‡å€¼å›å½’ç­–ç•¥
  - ç½‘æ ¼äº¤æ˜“ç­–ç•¥

### 3. å›æµ‹åŠŸèƒ½å¢å¼º

- **ç­–ç•¥åº“é€‰æ‹©**: å›æµ‹æ—¶å¯ä»¥ä»ç­–ç•¥åº“é€‰æ‹©å·²æœ‰ç­–ç•¥ï¼Œæ— éœ€é‡å¤è¾“å…¥ä»£ç 
- **çµæ´»é…ç½®**: æ”¯æŒé€šè¿‡ç­–ç•¥IDæˆ–ç›´æ¥æä¾›ç­–ç•¥ä»£ç ä¸¤ç§æ–¹å¼

### 4. å›æµ‹ç»“æœç®¡ç†

- **ç»“æœåˆ—è¡¨**: æ”¯æŒæŸ¥è¯¢æ‰€æœ‰å›æµ‹ç»“æœï¼Œæ”¯æŒæ’åº
- **ç»“æœåˆ é™¤**: æ”¯æŒåˆ é™¤å›æµ‹ç»“æœï¼ˆçº§è”åˆ é™¤ä»»åŠ¡ï¼‰

## APIæ¥å£

### ç­–ç•¥ç®¡ç†æ¥å£

#### åˆ›å»ºç­–ç•¥
```
POST /api/v1/backtest/strategies
```

è¯·æ±‚ä½“ï¼š
```json
{
  "name": "æˆ‘çš„ç­–ç•¥",
  "code": "ç­–ç•¥ä»£ç ...",
  "description": "ç­–ç•¥æè¿°",
  "category": "technical",
  "params_schema": "{}",
  "is_template": false
}
```

#### è·å–ç­–ç•¥åˆ—è¡¨
```
GET /api/v1/backtest/strategies?category=technical&search=å‡çº¿&skip=0&limit=100
```

#### è·å–æ¨¡æ¿ç­–ç•¥åˆ—è¡¨
```
GET /api/v1/backtest/strategies/templates?category=technical
```

#### è·å–ç­–ç•¥è¯¦æƒ…
```
GET /api/v1/backtest/strategies/{strategy_id}
```

#### æ›´æ–°ç­–ç•¥
```
PUT /api/v1/backtest/strategies/{strategy_id}
```

#### åˆ é™¤ç­–ç•¥
```
DELETE /api/v1/backtest/strategies/{strategy_id}
```

### å›æµ‹æ¥å£ï¼ˆå¢å¼ºï¼‰

#### è¿è¡Œå›æµ‹ï¼ˆæ”¯æŒç­–ç•¥åº“é€‰æ‹©ï¼‰
```
POST /api/v1/backtest/run
```

è¯·æ±‚ä½“ï¼ˆæ–¹å¼1ï¼šä»ç­–ç•¥åº“é€‰æ‹©ï¼‰ï¼š
```json
{
  "strategy_id": 1,
  "strategy_name": "ç­–ç•¥åç§°",
  "config": {
    "start_date": "2023-01-01",
    "end_date": "2023-12-31",
    "initial_capital": 1000000,
    "symbols": ["000001.SZ", "000002.SZ"],
    "frequency": "daily"
  }
}
```

è¯·æ±‚ä½“ï¼ˆæ–¹å¼2ï¼šç›´æ¥æä¾›ä»£ç ï¼‰ï¼š
```json
{
  "strategy_code": "ç­–ç•¥ä»£ç ...",
  "strategy_name": "ç­–ç•¥åç§°",
  "config": {...}
}
```

### å›æµ‹ç»“æœç®¡ç†æ¥å£

#### è·å–å›æµ‹ç»“æœåˆ—è¡¨
```
GET /api/v1/backtest/results?skip=0&limit=100&order_by=total_return&order=desc
```

#### åˆ é™¤å›æµ‹ç»“æœ
```
DELETE /api/v1/backtest/results/{result_id}
```

## å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–ç­–ç•¥æ¨¡æ¿

è¿è¡Œåˆå§‹åŒ–è„šæœ¬ï¼Œå°†ç¤ºä¾‹ç­–ç•¥å¯¼å…¥ä¸ºæ¨¡æ¿ï¼š

```bash
python zquant/scripts/init_strategies.py
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- åˆ›å»ºç­–ç•¥æ•°æ®åº“è¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- å¯¼å…¥8ç§ç­–ç•¥æ¨¡æ¿åˆ°æ•°æ®åº“
- æ ‡è®°ä¸ºæ¨¡æ¿ç­–ç•¥ï¼ˆ`is_template=True`ï¼‰

**æ³¨æ„**ï¼šæ¨¡æ¿ç­–ç•¥åªèƒ½ç”±ç®¡ç†å‘˜ä¿®æ”¹æˆ–åˆ é™¤ã€‚

### 2. æ•°æ®åº“è¿ç§»

å¦‚æœè¿˜æ²¡æœ‰åˆ›å»ºç­–ç•¥è¡¨ï¼Œéœ€è¦æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼š

```bash
alembic upgrade head
```

## ä½¿ç”¨ç¤ºä¾‹

### 2. åˆ›å»ºè‡ªå®šä¹‰ç­–ç•¥

#### æ–¹å¼ä¸€ï¼šé€šè¿‡APIåˆ›å»º

```python
import requests

# åˆ›å»ºç­–ç•¥
response = requests.post(
    "http://localhost:8000/api/v1/backtest/strategies",
    headers={"Authorization": "Bearer <your_token>"},
    json={
        "name": "æˆ‘çš„è‡ªå®šä¹‰ç­–ç•¥",
        "code": """
from zquant.backtest.context import Context
from zquant.backtest.strategy import BaseStrategy

class Strategy(BaseStrategy):
    def initialize(self):
        # åˆå§‹åŒ–ç­–ç•¥å‚æ•°
        self.param = self.params.get("param", 10)
    
    def on_bar(self, context: Context, bar_data: dict):
        # ç­–ç•¥é€»è¾‘
        symbol = bar_data['symbol']
        close = bar_data['close']
        
        # ç¤ºä¾‹ï¼šç®€å•ä¹°å…¥é€»è¾‘
        if close > self.param:
            context.order_target_percent(symbol, 1.0)
        else:
            context.order_target_percent(symbol, 0.0)
""",
        "description": "è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç­–ç•¥ç¤ºä¾‹",
        "category": "technical",
        "params_schema": '{"param": {"type": "number", "default": 10}}'
    }
)

print(response.json())
```

#### æ–¹å¼äºŒï¼šé€šè¿‡Webç•Œé¢åˆ›å»º

1. ç™»å½•ç³»ç»Ÿåï¼Œè®¿é—®"ç­–ç•¥ç®¡ç†"é¡µé¢
2. ç‚¹å‡»"æ–°å»ºç­–ç•¥"æŒ‰é’®
3. å¡«å†™ç­–ç•¥ä¿¡æ¯å¹¶ç¼–å†™ç­–ç•¥ä»£ç 
4. ä¿å­˜ç­–ç•¥

### 3. æŸ¥è¯¢ç­–ç•¥åˆ—è¡¨

```python
# è·å–æ‰€æœ‰ç­–ç•¥
response = requests.get(
    "http://localhost:8000/api/v1/backtest/strategies",
    headers={"Authorization": "Bearer <your_token>"},
    params={
        "category": "technical",  # å¯é€‰ï¼šæŒ‰åˆ†ç±»ç­›é€‰
        "search": "å‡çº¿",         # å¯é€‰ï¼šå…³é”®è¯æœç´¢
        "skip": 0,
        "limit": 100
    }
)

strategies = response.json()
print(f"æ‰¾åˆ° {len(strategies['items'])} ä¸ªç­–ç•¥")
```

### 4. è·å–ç­–ç•¥è¯¦æƒ…

```python
# è·å–ç‰¹å®šç­–ç•¥çš„è¯¦ç»†ä¿¡æ¯
response = requests.get(
    "http://localhost:8000/api/v1/backtest/strategies/1",
    headers={"Authorization": "Bearer <your_token>"}
)

strategy = response.json()
print(f"ç­–ç•¥åç§°: {strategy['name']}")
print(f"ç­–ç•¥ä»£ç : {strategy['code']}")
```

### 5. ä½¿ç”¨ç­–ç•¥è¿›è¡Œå›æµ‹

#### æ–¹å¼ä¸€ï¼šä»ç­–ç•¥åº“é€‰æ‹©ç­–ç•¥

```python
# ä½¿ç”¨ç­–ç•¥åº“ä¸­çš„ç­–ç•¥è¿›è¡Œå›æµ‹
response = requests.post(
    "http://localhost:8000/api/v1/backtest/run",
    headers={"Authorization": "Bearer <your_token>"},
    json={
        "strategy_id": 1,  # ä½¿ç”¨ç­–ç•¥åº“ä¸­çš„ç­–ç•¥ID
        "strategy_name": "æµ‹è¯•å›æµ‹",
        "config": {
            "start_date": "2023-01-01",
            "end_date": "2023-12-31",
            "initial_capital": 1000000,
            "symbols": ["000001.SZ", "000002.SZ"],
            "frequency": "daily",
            "params": {  # ç­–ç•¥å‚æ•°ï¼ˆå¯é€‰ï¼‰
                "param": 20
            }
        }
    }
)

result = response.json()
print(f"å›æµ‹ä»»åŠ¡ID: {result['task_id']}")
```

#### æ–¹å¼äºŒï¼šç›´æ¥æä¾›ç­–ç•¥ä»£ç 

```python
# ç›´æ¥æä¾›ç­–ç•¥ä»£ç è¿›è¡Œå›æµ‹ï¼ˆä¸ä¿å­˜åˆ°ç­–ç•¥åº“ï¼‰
response = requests.post(
    "http://localhost:8000/api/v1/backtest/run",
    headers={"Authorization": "Bearer <your_token>"},
    json={
        "strategy_code": """
from zquant.backtest.context import Context
from zquant.backtest.strategy import BaseStrategy

class Strategy(BaseStrategy):
    def on_bar(self, context: Context, bar_data: dict):
        # ç­–ç•¥é€»è¾‘
        pass
""",
        "strategy_name": "ä¸´æ—¶ç­–ç•¥å›æµ‹",
        "config": {
            "start_date": "2023-01-01",
            "end_date": "2023-12-31",
            "initial_capital": 1000000,
            "symbols": ["000001.SZ"],
            "frequency": "daily"
        }
    }
)
```

### 6. æŸ¥è¯¢å›æµ‹ç»“æœ

```python
# è·å–æ‰€æœ‰å›æµ‹ç»“æœï¼ŒæŒ‰æ€»æ”¶ç›Šç‡é™åºæ’åˆ—
response = requests.get(
    "http://localhost:8000/api/v1/backtest/results",
    headers={"Authorization": "Bearer <your_token>"},
    params={
        "skip": 0,
        "limit": 100,
        "order_by": "total_return",
        "order": "desc"
    }
)

results = response.json()
for result in results['items']:
    print(f"ç­–ç•¥: {result['strategy_name']}")
    print(f"æ€»æ”¶ç›Šç‡: {result['total_return']:.2%}")
    print(f"å¤æ™®æ¯”ç‡: {result['sharpe_ratio']:.2f}")
    print("---")
```

### 7. åˆ é™¤å›æµ‹ç»“æœ

```python
# åˆ é™¤æŒ‡å®šçš„å›æµ‹ç»“æœï¼ˆä¼šçº§è”åˆ é™¤å…³è”çš„ä»»åŠ¡ï¼‰
response = requests.delete(
    "http://localhost:8000/api/v1/backtest/results/1",
    headers={"Authorization": "Bearer <your_token>"}
)

if response.status_code == 200:
    print("å›æµ‹ç»“æœå·²åˆ é™¤")
```

## æœ€ä½³å®è·µ

### 1. ç­–ç•¥ä»£ç è§„èŒƒ

- **ç±»åå¿…é¡»ä¸º `Strategy`**ï¼šç­–ç•¥ä»£ç å¿…é¡»åŒ…å«åä¸º `Strategy` çš„ç±»
- **ç»§æ‰¿ `BaseStrategy`**ï¼šæ‰€æœ‰ç­–ç•¥å¿…é¡»ç»§æ‰¿è‡ª `BaseStrategy`
- **å®ç°å¿…è¦æ–¹æ³•**ï¼š
  - `initialize()`: åˆå§‹åŒ–ç­–ç•¥å‚æ•°
  - `on_bar()`: å¤„ç†æ¯ä¸ªäº¤æ˜“æ—¥çš„Kçº¿æ•°æ®

### 2. ç­–ç•¥å‚æ•°ç®¡ç†

- ä½¿ç”¨ `params_schema` å®šä¹‰ç­–ç•¥å‚æ•°ç»“æ„
- åœ¨ `initialize()` æ–¹æ³•ä¸­é€šè¿‡ `self.params.get()` è·å–å‚æ•°
- ä¸ºå‚æ•°è®¾ç½®åˆç†çš„é»˜è®¤å€¼

### 3. ç­–ç•¥åˆ†ç±»å»ºè®®

- `technical`: æŠ€æœ¯åˆ†æç±»ç­–ç•¥ï¼ˆå‡çº¿ã€RSIã€å¸ƒæ—å¸¦ç­‰ï¼‰
- `fundamental`: åŸºæœ¬é¢åˆ†æç±»ç­–ç•¥ï¼ˆPE/PBã€è´¢åŠ¡æŒ‡æ ‡ç­‰ï¼‰
- `quantitative`: é‡åŒ–ç­–ç•¥ç±»ï¼ˆåŠ¨é‡ã€å‡å€¼å›å½’ã€ç½‘æ ¼äº¤æ˜“ç­‰ï¼‰

### 4. å›æµ‹é…ç½®å»ºè®®

- **åˆå§‹èµ„é‡‘**ï¼šå»ºè®®ä½¿ç”¨100ä¸‡æˆ–1000ä¸‡ï¼Œä¾¿äºè®¡ç®—æ”¶ç›Šç‡
- **è‚¡ç¥¨æ± **ï¼šå»ºè®®é€‰æ‹©æµåŠ¨æ€§å¥½çš„è‚¡ç¥¨ï¼Œé¿å…åœç‰Œå½±å“
- **å›æµ‹å‘¨æœŸ**ï¼šå»ºè®®è‡³å°‘1å¹´ï¼Œä»¥è·å¾—æ›´å¯é çš„ç»Ÿè®¡ç»“æœ
- **é¢‘ç‡é€‰æ‹©**ï¼šæ—¥çº¿ï¼ˆ`daily`ï¼‰é€‚åˆå¤§å¤šæ•°ç­–ç•¥ï¼Œåˆ†é’Ÿçº¿ï¼ˆ`minute`ï¼‰é€‚åˆé«˜é¢‘ç­–ç•¥

### 5. æ€§èƒ½ä¼˜åŒ–

- é¿å…åœ¨ç­–ç•¥ä»£ç ä¸­è¿›è¡Œå¤æ‚è®¡ç®—ï¼Œå°½é‡ä½¿ç”¨å‘é‡åŒ–æ“ä½œ
- åˆç†ä½¿ç”¨ç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—
- å¯¹äºå¤§é‡è‚¡ç¥¨çš„å›æµ‹ï¼Œè€ƒè™‘åˆ†æ‰¹å¤„ç†

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ä¿®æ”¹æ¨¡æ¿ç­–ç•¥ï¼Ÿ

**A**: æ¨¡æ¿ç­–ç•¥ï¼ˆ`is_template=True`ï¼‰åªèƒ½ç”±ç®¡ç†å‘˜ä¿®æ”¹ã€‚æ™®é€šç”¨æˆ·å¯ä»¥ï¼š
1. å¤åˆ¶æ¨¡æ¿ç­–ç•¥ä»£ç 
2. åˆ›å»ºæ–°çš„è‡ªå®šä¹‰ç­–ç•¥
3. åŸºäºæ¨¡æ¿è¿›è¡Œä¿®æ”¹

### Q2: ç­–ç•¥ä»£ç æ‰§è¡Œå‡ºé”™æ€ä¹ˆåŠï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ç¡®ä¿ç±»åæ˜¯ `Strategy` ä¸”ç»§æ‰¿è‡ª `BaseStrategy`
2. æ£€æŸ¥æ–¹æ³•ç­¾åæ˜¯å¦æ­£ç¡®ï¼ˆ`on_bar(context, bar_data)`ï¼‰
3. æŸ¥çœ‹å›æµ‹ä»»åŠ¡çš„é”™è¯¯æ—¥å¿—
4. ä½¿ç”¨ç®€å•çš„æµ‹è¯•ä»£ç éªŒè¯ç­–ç•¥é€»è¾‘

### Q3: å¦‚ä½•æŸ¥çœ‹ç­–ç•¥çš„æ‰§è¡Œå†å²ï¼Ÿ

**A**: é€šè¿‡å›æµ‹ç»“æœåˆ—è¡¨å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ä½¿ç”¨è¯¥ç­–ç•¥çš„å›æµ‹è®°å½•ï¼ŒåŒ…æ‹¬ï¼š
- å›æµ‹æ—¶é—´
- å›æµ‹é…ç½®
- ç»©æ•ˆæŒ‡æ ‡
- å›æµ‹çŠ¶æ€

### Q4: åˆ é™¤ç­–ç•¥ä¼šå½±å“å·²æœ‰çš„å›æµ‹ç»“æœå—ï¼Ÿ

**A**: ä¸ä¼šã€‚åˆ é™¤ç­–ç•¥åªä¼šåˆ é™¤ç­–ç•¥æœ¬èº«ï¼Œä¸ä¼šå½±å“å·²ç»å®Œæˆçš„å›æµ‹ç»“æœã€‚ä½†åˆ é™¤å›æµ‹ç»“æœä¼šçº§è”åˆ é™¤å…³è”çš„å›æµ‹ä»»åŠ¡ã€‚

### Q5: å¦‚ä½•åˆ†äº«ç­–ç•¥ç»™å…¶ä»–ç”¨æˆ·ï¼Ÿ

**A**: ç›®å‰ç­–ç•¥æ˜¯ç”¨æˆ·éš”ç¦»çš„ï¼Œæ¯ä¸ªç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±åˆ›å»ºçš„ç­–ç•¥ã€‚å¦‚æœéœ€è¦åˆ†äº«ï¼š
1. å¯¼å‡ºç­–ç•¥ä»£ç 
2. å…¶ä»–ç”¨æˆ·å¯¼å…¥ç­–ç•¥ä»£ç åˆ›å»ºæ–°ç­–ç•¥
3. æˆ–è€…è”ç³»ç®¡ç†å‘˜å°†ç­–ç•¥è®¾ç½®ä¸ºæ¨¡æ¿ç­–ç•¥

## æ³¨æ„äº‹é¡¹

1. **æ¨¡æ¿ç­–ç•¥ä¿æŠ¤**ï¼šæ¨¡æ¿ç­–ç•¥ç”±ç³»ç»Ÿç®¡ç†å‘˜åˆ›å»ºï¼Œæ™®é€šç”¨æˆ·ä¸èƒ½ä¿®æ”¹æˆ–åˆ é™¤
2. **ç­–ç•¥ä»£ç è§„èŒƒ**ï¼šç­–ç•¥ä»£ç å¿…é¡»åŒ…å«åä¸º `Strategy` çš„ç±»ï¼Œç»§æ‰¿è‡ª `BaseStrategy`
3. **çº§è”åˆ é™¤**ï¼šåˆ é™¤å›æµ‹ç»“æœä¼šçº§è”åˆ é™¤å…³è”çš„å›æµ‹ä»»åŠ¡
4. **ç­–ç•¥åˆ†ç±»**ï¼šå»ºè®®ä½¿ç”¨æ ‡å‡†åˆ†ç±»ï¼š`technical`ï¼ˆæŠ€æœ¯åˆ†æï¼‰ã€`fundamental`ï¼ˆåŸºæœ¬é¢ï¼‰ã€`quantitative`ï¼ˆé‡åŒ–ï¼‰
5. **ä»£ç å®‰å…¨**ï¼šç­–ç•¥ä»£ç ä¼šåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œï¼Œè¯·ç¡®ä¿ä»£ç å®‰å…¨ï¼Œé¿å…æ¶æ„ä»£ç 

